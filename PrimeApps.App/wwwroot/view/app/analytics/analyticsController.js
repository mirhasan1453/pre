"use strict";angular.module("primeapps").controller("AnalyticsController",["$rootScope","$scope","$location","$filter","$timeout","$state","ngToast","AnalyticsService",function(e,t,n,a,r,o,d,i){return t.id=n.search().id,t.filterPaneEnabled=!1,t.analyticsLoading=!0,e.user.has_analytics?(t.embedReport=function(e){t.loading=!0;var n;n=e?e:t.id?a("filter")(t.analyticsReports,{id:parseInt(t.id)},!0)[0]:t.analyticsReports[0],t.analyticsCurrentReport=n;var o={type:"report",accessToken:n.access_token,embedUrl:n.embed_url,id:n.report_id,settings:{filterPaneEnabled:!1,navContentPaneEnabled:!1}},d=angular.element(document.getElementById("report"))[0];t.reportEmbedded=powerbi.embed(d,o),t.reportEmbedded.off("loaded"),t.reportEmbedded.on("loaded",function(){t.reportEmbedded.getPages().then(function(e){r(function(){t.pages=e,t.currentPage=e[0],t.loading=!1,t.analyticsLoading=!1})})})},t["delete"]=function(e){i["delete"](e).then(function(){i.getReports().then(function(e){e=e.data,t.analyticsLoading=!1,e&&(t.analyticsReports=e,e&&e.length>0&&t.embedReport(),t.reportEmbedded=void 0,t.analyticsCurrentReport=void 0,t.pages=[],t.currentPage=[])})})},i.getReports().then(function(e){e=e.data,t.analyticsLoading=!1,e&&(t.analyticsReports=e,e&&e.length>0&&t.embedReport())}),t.changePage=function(e){t.currentPage=e,t.reportEmbedded.setPage(e.name)},t.fullScreen=function(){t.reportEmbedded&&t.reportEmbedded.fullscreen()},t.enableFilterPane=function(e){t.reportEmbedded&&(t.reportEmbedded.updateSettings({filterPaneEnabled:e}),t.filterPaneEnabled=e)},t.cycle=function(e){t.cycling&&angular.forEach(t.pages,function(n){r(function(){t.changePage(n)},e)})},void(t.print=function(){t.reportEmbedded&&t.reportEmbedded.print()})):(d.create({content:a("translate")("Common.Forbidden"),className:"warning"}),void o.go("app.dashboard"))}]);