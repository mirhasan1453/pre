"use strict";angular.module("primeapps").controller("LeadConvertController",["$rootScope","$scope","$location","$state","$filter","$q","ngToast","helper","LeadConvertService","ModuleService","$cache",function(e,t,o,i,n,a,l,d,r,u,c){return t.id=o.search().id,t.module=n("filter")(e.modules,{name:"leads"},!0)[0],t.currentDayMin=d.getCurrentDateMin().toISOString(),t.currentDayMax=d.getCurrentDateMax().toISOString(),t.deleted=!1,t.module&&t.id?(t.accountModule=n("filter")(e.modules,{name:"accounts"},!0)[0],t.contactModule=n("filter")(e.modules,{name:"contacts"},!0)[0],t.opportunityModule=n("filter")(e.modules,{name:"opportunities"},!0)[0],t.nameField=n("filter")(t.opportunityModule.fields,{name:"name"},!0)[0],t.amountField=n("filter")(t.opportunityModule.fields,{name:"amount"},!0)[0],t.closingDateField=n("filter")(t.opportunityModule.fields,{name:"closing_date"},!0)[0],t.stageField=n("filter")(t.opportunityModule.fields,{name:"stage"},!0)[0],t.leadModulePrimaryField=n("filter")(t.module.fields,{primary:!0},!0)[0],t.loading=!0,u.getPicklists(t.opportunityModule).then(function(e){t.stageList=e[t.stageField.picklist_id]}),u.getPicklists(t.module).then(function(e){t.picklistsModule=e,u.getRecord(t.module.name,t.id).then(function(e){t.lead=u.processRecordSingle(e.data,t.module,t.picklistsModule),u.formatRecordFieldValues(angular.copy(e.data),t.module,t.picklistsModule)})["finally"](function(){t.loading=!1})}),void(t.convert=function(){if(!t.createOpportunity||t.opportunityForm.$valid){t.loading=!0;var e={};e.lead_id=t.lead.id,e.deleted=t.deleted,t.opportunity&&(e.opportunity=t.opportunity),r.convert(e).then(function(e){t.converted=e.data,t.convertDisable=!0,c.remove("leads_leads"),c.remove("accounts_accounts"),c.remove("contacts_contacts"),c.remove("opportunities_opportunities"),c.remove("activities_activities"),l.create({content:n("translate")("Convert.Success",{type:t.module["label_"+language+"_singular"]}),className:"success"})})["catch"](function(e){409===e.status&&t.moduleForm[e.data.field].$setValidity("unique",!1)})["finally"](function(){t.loading=!1})}})):(l.create({content:n("translate")("Common.NotFound"),className:"warning"}),void i.go("app.dashboard"))}]);