"use strict";angular.module("primeapps").controller("QuoteConvertController",["$rootScope","$scope","$location","$state","$filter","$q","$window","ngToast","QuoteConvertService","ModuleService","$cache",function(e,o,t,r,s,a,n,l,d,i,c){if(o.id=t.search().id,o.module=s("filter")(e.modules,{name:"quotes"},!0)[0],!o.module)return l.create({content:s("translate")("Common.NotFound"),className:"warning"}),void r.go("app.dashboard");if(!o.id)return l.create({content:s("translate")("Common.NotFound"),className:"warning"}),void r.go("app.dashboard");var u=s("filter")(e.modules,{name:"sales_orders"},!0)[0];o.loading=!0,i.getPicklists(u).then(function(e){var t=s("filter")(u.fields,{name:"order_stage"},!0)[0];o.stageList=e[t.picklist_id]}),i.getPicklists(o.module).then(function(e){o.picklistsModule=e,i.getRecord(o.module.name,o.id).then(function(e){o.quote=i.processRecordSingle(e.data,o.module,o.picklistsModule),i.formatRecordFieldValues(angular.copy(e.data),o.module,o.picklistsModule)})["finally"](function(){o.loading=!1})}),o.salesOrderModule=s("filter")(e.modules,{name:"sales_orders"},!0)[0],o.stageField=s("filter")(o.salesOrderModule.fields,{name:"order_stage"},!0)[0],o.convert=function(){o.converting=!0;var e={};e.quote_id=o.quote.id,o.order_stage&&(e.order_stage=o.order_stage),d.convert(e).then(function(e){o.convertDisable=!0,c.remove("quotes_quotes"),c.remove("sales_orders_sales_orders"),l.create({content:s("translate")("Convert.Quote.Success"),className:"success"}),n.location.href="#/app/module/sales_orders?id="+e.data.sales_order_id+"&back=quotes"})["catch"](function(){o.converting=!1})}}]);