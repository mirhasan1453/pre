"use strict";angular.module("primeapps").controller("AdvDocumentSearchController",["$rootScope","$scope","config","$location","guidEmpty","$filter","ngToast","DocumentService","entityTypes","helper","$localStorage","$window",function(e,r,t,a,l,o,s,n,c,d,i,u){function h(e,t,a){var l={};l.searchText=e,l.selectedQueryOperator=t,l.selectedOperator=a,r.searchParameters.push(l)}r.loading=!1,r.searchParameters=[],r.modulesList=[],angular.forEach(e.modules,function(e){var t=o("filter")(e.fields,{data_type:"document",document_search:!0,deleted:!1},!0);t.length>0&&r.modulesList.push(e)}),r.resetSearchParameters=function(){r.searchParameters=[],h(),r.searched=null},h(),r.documents=[],r.applyFilter=function(e,t,a,l){var s=[];if(angular.forEach(r.searchParameters,function(e){var r={};r.searchText=e.searchText,r.queryOperator=e.selectedQueryOperator,r.operator=e.selectedOperator,e.searchText&&e.selectedQueryOperator&&s.push(r)}),s.length>0&&r.searchModule){a&&(r.loading=!0,r.documents=[]),l&&(r.searched=!0,r.bottomloading=!0);var c=r.searchModule.name;n.advancedSearch(c,s,e,t).then(function(e){e=e.data,e&&e.data?(angular.forEach(e.data,function(e){r.documents.push(e)}),r.searchResult=o("translate")("Filter.FoundResult",{searchResultCount:e.totalCount}),r.errorAddingFilter=null):(r.searchResult=o("translate")("Filter.FoundResult",{searchResultCount:0}),r.errorAddingFilter=o("translate")("Filter.NotIndexedModule")),r.loading=!1,r.searched=!0,r.bottomloading=!1})["catch"](function(){r.bottomloading=!1,r.loading=!1,r.searched=!0}),r.searched=!0}else r.errorAddingFilter=o("translate")("Filter.NoSearchStarted");r.searched=!1},r.searchParameterAdd=function(e){var t=e.searchText,a=e.selectedQueryOperator,l=e.selectedOperator;if(r.errorAddingFilter=null,r.searchModule,e.searchText&&e.selectedQueryOperator&&e.selectedOperator){r.searchParameters.length<=10?h(t,a,l):(s.create({content:o("translate")("Filter.MaximumFilterWarning",{limit:10}),className:"warning"}),r.errorAddingFilter=o("translate")("Filter.MaximumFilterWarning",{limit:10}));var n=r.searchParameters[r.searchParameters.length-1];n.searchText=null,n.selectedQueryOperator="",n.selectedOperator=""}else r.searchModule?e.searchText?e.selectedQueryOperator?e.selectedOperator||(r.errorAddingFilter=o("translate")("Filter.PleaseOperator")):r.errorAddingFilter=o("translate")("Filter.PleaseQueryOperator"):r.errorAddingFilter=o("translate")("Filter.PleaseSearchText"):r.errorAddingFilter=o("translate")("Filter.PleaseSelectModule")},r.searchParameterRemove=function(e){var t=r.searchParameters.indexOf(e);r.searchParameters.splice(t,1)},r.downloadDocument=function(e,r,a,l){var o=e.split(".")[0];o=o.replace(l+"_","");var s=r.split(".")[0],n=t.apiUrl+"Document/download_module_document?module="+a+"&fileNameExt="+d.getFileExtension(e)+"&fileName="+s+"&fieldName="+o+"&recordId="+l+"&access_token="+i.read("access_token");u.location=n}}]);