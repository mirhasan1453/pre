"use strict";angular.module("primeapps").controller("DocumentController",["$rootScope","$scope","$location","guidEmpty","$filter","$popover","DocumentService","entityTypes","helper","operations","$stateParams","ModuleService",function(e,t,o,n,r,s,a,u,i,c,l,m){function d(o){t.loading=!o,a.getDocuments(e.workgroup.tenant_id,t.entityId,t.module.id).then(function(o){var n=a.processDocuments(o.data,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=n.documentList,f=angular.copy(n.documentList),t.loading=!1})}t.documents=[],t.title=r("translate")("Documents.Documents"),t.guidEmpty=n,t.entityId=n,t.entityType=n,t.type=l.type;var p=o.search().id,y=l.type,f=[];t.filter={},t.filter.CreatedBy=n,t.sortPredicate="Timestamp",t.sortReverse=!0,t.hasPermission=i.hasPermission,t.entityTypes=u,t.operations=c,t.module=r("filter")(e.modules,{name:l.type},!0)[0],p&&y&&(null===p&&null===y?(t.title=r("translate")("Dashboard.AllDocuments"),t.filter.CreatedBy=e.user.id):(m.getRecord(t.module.name,p).then(function(e){t.title=null==e.data.name?r("translate")("Documents.Documents"):e.data.name}),t.entityId=p,t.entityType=y)),d(),t.filterDocuments=function(o){t.filter.CreatedBy=o,a.getDocuments(e.workgroup.tenant_id,t.entityId,t.module.id).then(function(o){var n=a.processDocuments(o.data,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=n.documentList,f=angular.copy(n.documentList)})},t.searchDocuments=function(o){var n=[];angular.forEach(angular.copy(f),function(e){e.Name&&(e.Name.toLowerCase().indexOf(o.toLowerCase())>-1||e.description.toLowerCase().indexOf(o.toLowerCase())>-1)&&n.push(e)});var r={Documents:n,TotalDocumentsCount:n.length,FilteredDocumentsCount:n.length},s=a.processDocuments(r,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=s.documentList},t.sortDocuments=function(o,n){t.sortPredicate=o,t.sortReverse=n;var r={Documents:angular.copy(f),TotalDocumentsCount:angular.copy(f).length,FilteredDocumentsCount:angular.copy(f).length},s=a.processDocuments(r,e.users,t.filter,t.sortPredicate,t.sortReverse);t.documents=s.documentList}}]);