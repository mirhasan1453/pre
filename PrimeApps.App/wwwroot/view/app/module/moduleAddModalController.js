"use strict";angular.module("primeapps").controller("ModuleAddModalController",["$rootScope","$scope","ngToast","$filter","helper","$location","$state","$stateParams","$q","$window","$localStorage","$cache","operations","$modal","ModuleService",function(e,l,t,d,a,o,r,n,u,c,s,i,p,$,m){l.loadingModal=!0,l.operations=p,l.hasPermission=a.hasPermission,l.selectedRelatedModule=angular.copy(l.$parent.$parent.selectedRelatedModule),l.relatedModule={},l.relatedModule.related_module=l.selectedRelatedModule.related_module,l.relatedModule.relation_field=l.selectedRelatedModule.relation_field,l.relatedModule.display_fields=l.selectedRelatedModule.display_fields,l.relatedModule.readonly=!0,l.relationKey=l.selectedRelatedModule.relation_field+"_"+l.selectedRelatedModule.related_module,l.addRecords=function(){if(l.selectedRows=l["selectedRows"+l.relatedModule.related_module],!l.selectedRows.length)return void t.create({content:d("translate")("Module.NoRecordSelected"),className:"warning"});var e=l.$parent.$parent["currentTotalCount"+l.relatedModule.related_module];if(l.selectedRows.length+e>200)return void t.create({content:d("translate")("Module.MaxRecordSelected",{count:l.selectedRows.length+e-200}),className:"warning"});l.recordsAdding=!0;var a=[];angular.forEach(l.selectedRows,function(e){var t={};l.$parent.$parent.type!=l.selectedRelatedModule.related_module?(t[l.$parent.$parent.type+"_id"]=l.$parent.$parent.id,t[l.selectedRelatedModule.related_module+"_id"]=e.id):(t[l.$parent.$parent.type+"1_id"]=l.$parent.$parent.id,t[l.selectedRelatedModule.related_module+"2_id"]=e.id),a.push(t)}),m.addRelations(l.$parent.$parent.type,l.selectedRelatedModule.related_module,a).then(function(e){l.recordsAdding=!1,l.$parent.$hide();var t=new Date;l.$parent.$parent.refreshSubModules[l.$parent.$parent.type]={},l.$parent.$parent.refreshSubModules[l.$parent.$parent.type][l.selectedRelatedModule.related_module]=t.getTime();var a=d("filter")(l.$parent.$parent.module.relations,{related_module:l.relatedModule.related_module,deleted:!1},!0)[0];(void 0===a.total||null===a.total)&&(a.total=0),a.total+=e.data,i.remove(l.$$childHead.cacheKey)})},l.fullScreenIcon=!0,l.fullScreen=function(){l.fullScreenIcon=!1,l.FullScreenShow="width: 100% !important"},l.exitFullScreen=function(){l.fullScreenIcon=!0,l.FullScreenShow="width: 800px !important"},l.openCreateModal=function(e){l.currentLookupField={lookup_type:e},l.formModal=l.formModal||$({scope:l,templateUrl:"view/app/module/moduleFormModal.html",animation:"",backdrop:"static",show:!1,tag:"createModal",size:"lg"}),l.formModal.$promise.then(l.formModal.show)},l.refresh=function(){var e=new Date;l.refreshSubModules[l.relationKey]=e.getTime()},l.formModalSuccess=function(){l.refresh()}}]);