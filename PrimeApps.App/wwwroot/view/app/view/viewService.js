angular.module("primeapps").factory("ViewService",["$rootScope","$http","config","$q","$filter","ModuleService",function(e,l,a,r,i,t){return{create:function(e){return l.post(a.apiUrl+"view/create",e)},update:function(e,r){return l.put(a.apiUrl+"view/update/"+r,e)},getFields:function(l,a){var r=angular.copy(l.fields),n={};n.selectedFields=[],n.availableFields=[],n.allFields=[],r=i("filter")(r,{display_list:!0,lookup_type:"!relation"},!0);var o={};o.name="seperator-main",o.label="tr"===e.language?l.label_tr_singular:l.label_en_singular,o.order=0,o.seperator=!0,r.push(o);var s=0;return angular.forEach(r,function(l){if("lookup"===l.data_type&&"relation"!=l.lookup_type){var a=angular.copy(i("filter")(e.modules,{name:l.lookup_type},!0)[0]);if(s+=100,null===a||void 0===a)return;var t={};t.name="seperator-"+a.name,t.order=s,t.seperator=!0,t.label="tr"===e.language?a.label_tr_singular+" ("+l.label_tr+")":a.label_en_singular+" ("+l.label_en+")",r.push(t);var n=angular.copy(a.fields);n=i("filter")(n,{display_list:!0},!0),angular.forEach(n,function(i){"lookup"!==i.data_type&&(i.label="tr"===e.language?i.label_tr:i.label_en,i.labelExt="("+l.label+")",i.name=l.name+"."+a.name+"."+i.name,i.order=parseInt(i.order)+s,r.push(i))})}}),angular.forEach(r,function(e){if(!e.deleted&&(t.hasFieldDisplayPermission(e)||"large"==e.multiline_type)){var r=null;a.fields&&(r=i("filter")(a.fields,{field:e.name},!0)[0]);var o={};if(o.name=e.name,o.label=e.label,o.labelExt=e.labelExt,o.order=e.order,o.lookup_type=e.lookup_type,o.seperator=e.seperator,o.multiline_type=e.multiline_type,r)o.order=r.order,n.selectedFields.push(o);else{var s=i("filter")(l.fields,{primary:!0},!0)[0];e.name!=s.name?n.availableFields.push(o):n.selectedFields.push(o)}n.allFields.push(o)}}),n.selectedFields=i("orderBy")(n.selectedFields,"order"),n.availableFields=i("orderBy")(n.availableFields,"order"),n}}}]);