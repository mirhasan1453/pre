"use strict";angular.module("primeapps").controller("AuditLogController",["$rootScope","$scope","config","ngToast","$localStorage","$filter","ngTableParams","$stateParams","AuditLogService",function(t,e,i,a,o,n,l,r,u){e.actionTypes=u.getActionsTypes(),e.currentPage=1;var d=function(t,i,a,o,n,l,r){e.allLogsLoaded=!1;var d={limit:t,offset:(i-1)*t,record_action_type:a,setup_action_type:o,user_id:n,start_date:l,end_date:r};u.find(d).then(function(t){t=t.data,e.pagingIcon="fa-chevron-right",e.auditLogs=1===e.currentPage?u.process(t,e.allModules):e.auditLogs.concat(u.process(t,e.allModules)),(t.length<1||t.length<d.limit)&&(e.allLogsLoaded=!0),e.searching=!1})};e.init=1,e.find=function(){if(1===e.init)return e.searching=!0,e.init++,void d(30,1);if(!e.auditLogFilter)return void d(30,e.currentPage);var t=null,i=null,a=null,o=null,n=null;e.auditLogFilter.action_type&&(e.auditLogFilter.action_type.indexOf("module")>-1?i=e.auditLogFilter.action_type:t=e.auditLogFilter.action_type),e.auditLogFilter.user&&(a=e.auditLogFilter.user),e.auditLogFilter.startDate&&(o=e.auditLogFilter.startDate),e.auditLogFilter.endDate&&(n=e.auditLogFilter.endDate),d(30,e.currentPage,t,i,a,o,n)},e.loadMore=function(){e.allLogsLoaded||(e.pagingIcon="fa-spinner fa-spin",e.currentPage=e.currentPage+1,e.find())},e.cancel=function(){e.showFilter=!1,e.showFilterButton=!0,e.auditLogFilter&&(e.auditLogFilter=null,e.find())},e.allModules?e.find():u.getDeletedModules().then(function(i){e.allModules=t.modules.concat(i.data),e.find()})}]);