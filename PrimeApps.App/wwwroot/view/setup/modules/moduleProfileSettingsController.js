"use strict";angular.module("primeapps").controller("ModuleProfileSettingController",["$rootScope","$scope","$filter","$state","$stateParams","ngToast","$modal","helper","$cache","systemRequiredFields","systemReadonlyFields","ModuleSetupService","ModuleService","AppService",function(e,t,r,i,l,n,o,a,u,f,c,s,d){t.loading=!0;var g=r("filter")(e.modules,{name:l.module},!0)[0];if(!g)return n.create({content:r("translate")("Common.NotFound"),className:"warning"}),void i.go("app.dashboard");t.module=angular.copy(g);var p=function(){s.getAllModuleProfileSettings().then(function(i){for(var l=r("filter")(i.data,{module_id:t.module.id},!0),n=0;n<l.length;n++)for(var o=0;o<l[n].profile_list.length;o++){var a=r("filter")(e.profiles,{id:parseInt(l[n].profile_list[o])},!0)[0].name;l[n].profileName?l[n].profileName+=", "+a:l[n].profileName=a}t.profileSettings=l,t.profileSettingState=angular.copy(t.profileSettings),t.loading=!1})["catch"](function(){t.loading=!1})};p(),t.showFormModal=function(i){if(t.currentProfileSetting={},t.icons=d.getIcons(),t.multiselect=function(){return r("filter")(e.profiles,{deleted:!1,has_admin_rights:!1},!0)},i){var l=[];if(i.profile_list.length>0)for(var n=0;n<i.profile_list.length;n++){var a=r("filter")(e.profiles,{id:parseInt(i.profile_list[n])},!0)[0];l.push(a)}t.currentProfileSetting.id=i.id,t.currentProfileSetting.profiles=l,t.currentProfileSetting.pluralName=i.label_tr_plural,t.currentProfileSetting.singularName=i.label_tr_singular,t.currentProfileSetting.menu_icon=i.menu_icon,t.currentProfileSetting.display=i.display}i||(t.currentProfileSetting.isNew=!0,t.currentProfileSetting.pluralName=t.module.label_tr_plural,t.currentProfileSetting.singularName=t.module.label_tr_singular,t.currentProfileSetting.menu_icon=t.module.menu_icon,t.currentProfileSetting.display=!0),t.currentProfileSettingState=angular.copy(t.currentProfileSetting),t.formModal=t.formModal||o({scope:t,templateUrl:"view/setup/modules/moduleProfileSettingForm.html",animation:"",backdrop:"static",show:!1}),t.formModal.$promise.then(function(){t.formModal.show()})},t.save=function(e){if(e.$valid){t.saving=!0;var i=angular.copy(t.currentProfileSetting);i.isNew&&delete i.isNew;var l=null;if(t.currentProfileSetting.profiles&&t.currentProfileSetting.profiles.length)for(var o=0;o<t.currentProfileSetting.profiles.length;o++){var a=t.currentProfileSetting.profiles[o];null===l?l=a.id:l+=","+a.id}var u;u=t.currentProfileSetting.menu_icon?t.currentProfileSetting.menu_icon:t.module.menu_icon;var f={module_id:t.module.id,profiles:l,label_en_singular:t.currentProfileSetting.singularName,label_tr_singular:t.currentProfileSetting.singularName,label_en_plural:t.currentProfileSetting.pluralName,label_tr_plural:t.currentProfileSetting.pluralName,menu_icon:u,display:t.currentProfileSetting.display},c=function(){p(),n.create({content:r("translate")("Setup.Modules.ModuleProfileSettingSaveSuccess"),className:"success"}),t.saving=!1,t.formModal.hide()};i.id?s.updateModuleProfileSetting(i.id,f).then(function(){c()})["catch"](function(){t.actionButtons=t.actionButtonState,t.formModal&&(t.formModal.hide(),t.saving=!1)}):s.createModuleProfileSetting(f).then(function(){c()})["catch"](function(){t.profileSettings=t.profileSettingState,t.formModal&&(t.formModal.hide(),t.saving=!1)})}},t["delete"]=function(e){delete e.$$hashKey;var i=angular.copy(t.profileSettings),l=a.arrayObjectIndexOf(i,e);i.splice(l,1),s.deleteModuleProfileSetting(e.id).then(function(){var i=a.arrayObjectIndexOf(t.profileSettings,e);t.profileSettings.splice(i,1),n.create({content:r("translate")("Setup.Modules.ModuleProfileSettingDeleteSuccess"),className:"success"})})["catch"](function(){t.profileSettings=t.profileSettingState,t.formModal&&(t.formModal.hide(),t.saving=!1)})},t.cancel=function(){angular.forEach(t.currentProfileSetting,function(e,r){t.currentProfileSetting[r]=t.currentProfileSettingState[r]}),t.formModal.hide()}}]);