"use strict";angular.module("primeapps").controller("OutlookController",["$rootScope","$scope","$filter","ngToast","OutlookService","AppService",function(e,t,o,l,i,a){t.modulesHasEmail=[],t.hasAdminRight=o("filter")(e.profiles,{id:e.user.profile.id},!0)[0].has_admin_rights;for(var n=0;n<e.modules.length;n++){var u=e.modules[n],s=o("filter")(u.fields,{data_type:"email",deleted:"!true",display_form:!0});s.length>0&&t.modulesHasEmail.push(angular.copy(u))}var r=function(){i.getSettings().then(function(e){var l=e.data;if(l){t.outlookSetting={};var i=o("filter")(l,{key:"outlook_module"},!0)[0],a=o("filter")(l,{key:"outlook_email_field"},!0)[0];i&&(t.outlookSetting.module=o("filter")(t.modulesHasEmail,{name:i.value},!0)[0]),a&&(t.outlookSetting.emailField=o("filter")(t.outlookSetting.module.fields,{name:a.value},!0)[0])}})};r(),t.save=function(){if(t.outlookSettingsForm.$valid){t.saving=!0;var n=function(){var e={};e.module=t.outlookSetting.module.name,e.email_field=t.outlookSetting.emailField.name,i.saveSettings(e).then(function(){a.getMyAccount(!0),l.create({content:o("translate")("Setup.Settings.UpdateSuccessGeneralSettings"),className:"success"}),t.saving=!1})},u=o("filter")(e.modules,{name:"mails"},!0)[0];u?n():i.createMailModule().then(function(){n()})}}}]);