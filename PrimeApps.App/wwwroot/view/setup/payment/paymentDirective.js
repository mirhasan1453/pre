"use strict";angular.module("primeapps").directive("paymentForm",["$filter","ngToast","PaymentService","AppService",function(a,e,t,n){return{restrict:"EA",scope:{payment:"="},templateUrl:"view/setup/payment/paymentForm.html",controller:["$rootScope","$scope",function(r,c){function i(){c.visaCard="off",c.masterCard="off",c.maestroCard="off",c.amexCard="off",c.discoverCard="off",c.jcbCard="off"}function o(a){if(a){c.paymentInfoForm.cardNumber.$setValidity("cardNumber",!1);for(var e in p)if(p[e].test(a))return void c.paymentInfoForm.cardNumber.$setValidity("cardNumber",!0)}}c.expirationMonths=[],c.expirationYears=[],c.user=r.user;for(var s=1;13>s;s++)c.expirationMonths.push(s);for(var d=(new Date).getFullYear(),m=d-1;2050>m;m++)c.expirationYears.push(m+1);i();var p;p={visa:/^4[0-9]{12}(?:[0-9]{3})?$/,mastercard:/^5[1-5][0-9]{14}$/,maestro:/^6[7-9][0-9]{0,17}$/,amex:/^3[47][0-9]{13}$/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,jcb:/^(?:2131|1800|35\d{3})\d{11}$/},c.changeCardType=function(a){i(),p.visa.test(a)?c.visaCard="on":p.mastercard.test(a)?c.masterCard="on":p.maestro.test(a)?c.maestroCard="on":p.amex.test(a)?c.amexCard="on":p.discover.test(a)?c.discoverCard="on":p.jcb.test(a)&&(c.jcbCard="on")},c.update=function(r){o(r.CardNumber),c.$broadcast("show-errors-check-validity"),c.paymentInfoForm.$valid&&(c.paymentUpdating=!0,t.update(r).then(function(){c.paymentUpdating=!1,c.$root.licenseStatus&&(c.$root.licenseStatus.LicenseUsage.IsInNotificationPeriod=!1),n.getMyAccount(!0),e.create({content:a("translate")("Setup.Settings.UpdateSuccess"),className:"success"})})["catch"](function(){c.paymentUpdating=!1}))},c.updateCampaign=function(n){c.campaingForm.campaignCode.$setValidity("campaignCode",!0),c.campaingForm.$valid&&(c.campaignUpdating=!0,t.checkCampaignCode(n.CampaignCode).then(function(r){return r.data?void t.updateCampaign(n.id,n.CampaignCode).then(function(){c.campaignUpdating=!1,e.create({content:a("translate")("Setup.Payment.CampaignUpdateSuccess"),className:"success"})})["catch"](function(){c.campaignUpdating=!1}):(c.campaingForm.campaignCode.$setValidity("campaignCode",!1),void(c.campaignUpdating=!1))}))},c.changeCurrency=function(n){t.changeCurrency(n).then(function(){r.user.currency=n,e.create({content:a("translate")("Setup.Settings.CurrencySuccess"),className:"success"})})}}]}}]);