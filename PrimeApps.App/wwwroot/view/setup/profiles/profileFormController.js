"use strict";angular.module("primeapps").controller("ProfileFormController",["$rootScope","$scope","$location","$state","$filter","ngToast","ProfileService",function(e,r,i,a,l,t,o){function s(){o.getAll().then(function(i){if(r.profiles=o.getProfiles(i.data,e.workgroup.tenant_id,!1),r.profilesCopy=angular.copy(r.profiles),f){r.profile=l("filter")(r.profiles,{id:f},!0)[0];var a=l("filter")(r.startPageList,{valueLower:r.profile.start_page},!0)[0];r.profile.PageStart=a,0!=r.profile.parent_id&&(r.profile.parent_id=l("filter")(r.profiles,{id:r.profile.parent_id},!0)[0])}else if(r.profile={},r.profile.tenant_id=e.workgroup.tenant_id,n){var t=l("filter")(r.profiles,{id:n},!0)[0];r.profile=t,delete r.profile.name,delete r.profile.user_ids,delete r.profile.description,delete r.profile.is_persistent,delete r.profile.CreatedBy,delete r.profile.id;var a=l("filter")(r.startPageList,{valueLower:r.profile.start_page},!0)[0];r.profile.PageStart=a,r.profile.parent_id=l("filter")(r.profiles,{id:t.parent_id},!0)[0]}else{r.profile.has_admin_rights=!1,r.profile.is_persistent=!1,r.profile.business_intelligence=!1,r.profile.send_email=!1,r.profile.send_sms=!1,r.profile.export_data=!1,r.profile.import_data=!1,r.profile.word_pdf_download=!1,r.profile.lead_convert=!1,r.profile.document_search=!1,r.profile.tasks=!1,r.profile.calendar=!1,r.profile.newsfeed=!1,r.profile.report=!1,r.profile.dashboard=!0,r.profile.home=!1,r.profile.collective_annual_leave=!1,r.profile.permissions=l("filter")(r.profiles,{is_persistent:!0,has_admin_rights:!0})[0].permissions;var s=l("filter")(r.startPageList,{value:"Dashboard"},!0)[0];r.profile.PageStart=s}r.loading=!1})["catch"](function(){r.loading=!1})}function p(){var e=!0,i=null;return r.profile.id?(i=l("filter")(r.profilesCopy,{Name:r.profile.name},!0)[0],i&&i.id!==r.profile.id&&(e=!1)):(i=l("filter")(r.profilesCopy,{Name:r.profile.name},!0)[0],i&&(e=!1)),e||r.profileForm.name.$setValidity("unique",!1),e}r.loading=!0;var f=parseInt(i.search().id),n=parseInt(i.search().clone);r.moduleLead=l("filter")(e.modules,{name:"leads"},!0)[0],r.moduleIzinler=l("filter")(e.modules,{name:"izinler"},!0)[0],r.moduleRehber=l("filter")(e.modules,{name:"rehber"},!0)[0],r.startPageList=[{value:"Dashboard",valueLower:"dashboard",name:l("translate")("Layout.Menu.Dashboard")},{value:"Newsfeed",valueLower:"newsfeed",name:l("translate")("Layout.Menu.Newsfeed")},{value:"Tasks",valueLower:"tasks",name:l("translate")("Layout.Menu.Tasks")},{value:"Calendar",valueLower:"calendar",name:l("translate")("Layout.Menu.Calendar")}],r.moduleRehber&&r.startPageList.push({value:"Home",valueLower:"home",name:l("translate")("Layout.Menu.Homepage")}),s(),r.SetStartPage=function(){var e=r.profile.PageStart.value;if(r.profile[e]=!0,"Newsfeed"===r.profile.PageStart.value){var i=l("filter")(r.profile.Permissions,{Type:3},!0)[0];i.Read=!0}},r.submit=function(){if(p(),r.profileForm.$valid){r.profileSubmit=!0;var i=null;r.profile.start_page=r.profile.PageStart.valueLower;var s=l("filter")(r.startPageList,{value:r.profile.PageStart.value},!0)[0];if(r.profile[s.value]=!0,"newsfeed"===r.profile.startpage){var f=l("filter")(r.profile.Permissions,{Type:3},!0)[0];f.Read=!0}r.profile.parent_id=r.profile.parent_id?r.profile.parent_id.id:0,i=r.profile.id?o.update(r.profile):o.create(r.profile),i.then(function(){r.profileSubmit=!1,a.go("app.setup.profiles"),t.create({content:l("translate")("Setup.Profiles.SubmitSuccess"),className:"success"}),o.getAllBasic().then(function(r){e.profiles=r.data})})["catch"](function(){r.profileSubmit=!1})}}}]);